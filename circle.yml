machine:
  environment:
    TRANSPORTER_DEP_FOLDER: "/home/ubuntu/.go_workspace/src/github.com/wawandco/transporter"
    TRANS_TESTING_FOLDER: "/home/ubuntu/testing_folder"
    TEST_DATABASE_URL:   "user=ubuntu dbname=circle_test sslmode=disable"
  services:
    - postgresql

dependencies:
  override:
    - rm -rf /home/ubuntu/testing_folder
    - mkdir -p /home/ubuntu/testing_folder
    - rm -rf $TRANSPORTER_DEP_FOLDER
    - mkdir -p $TRANSPORTER_DEP_FOLDER
    - cp -R ./Godeps $TRANSPORTER_DEP_FOLDER/Godeps
    - cp -R ./utils $TRANSPORTER_DEP_FOLDER/utils
    - cp -R ./cmd $TRANSPORTER_DEP_FOLDER/cmd
    - cp -R ./transporter $TRANSPORTER_DEP_FOLDER/transporter


test:
  pre:
    - psql -c "DROP TABLE IF EXISTS other_table;" -U ubuntu -d circle_test
    - psql -c "DROP TABLE IF EXISTS transporter_migrations;" -U ubuntu -d circle_test
    - psql -c "DROP TABLE IF EXISTS down_table;" -U ubuntu -d circle_test
  override:
    - go test ./... -v -run TestDown
